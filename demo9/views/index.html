<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>��������</title>
    <style>
        .common {
            width: 100%;
            border: 1px solid #ccc;
            margin: 10px auto;
        }
        div.list
        {
        background:white white #D5D5D5 #D5D5D5;
        border:1px solid;
        width:*;
        height:*;
        overflow:scroll-indicator;
        }
    </style>
</head>
<body>
<div class="common">
    <table class="table">
		<tr>
            <td>���飺</td>
            <td>
               <select name="conference" id="retconference">
					<option value="0">��ѡ�����</option>
				</select>
            </td>
        </tr>
        <tr>
            <td>�ļ�(xlsx,csv)��</td>
            <td>
               <button id="selFile">ѡ���ļ�</button>
			   <span id="filePath"></span>
            </td>
        </tr>
        
        <tr>
            <td>ͷ���ļ��У�</td>
            <td>
                 <button id="selFolder">ѡ��Ŀ¼</button>
				 <span id="folderPath"></span>
            </td>
        </tr>
		<tr>
            <td colspan="2" style="text-align:center;vertical-align:middle;">
			    <button id="uploadFile">�ϴ�</button>
			</td>
        </tr>
    </table>
</div>
<div id="result" class="list">
 <iframe id="reqRet"></iframe>
	<span id="respRet"></span>
</div>
<script type="text/tiscript">
    self.ready = function() {
        var file = "";
        var folder = "";
		var click_enable = true
		
		var retconferences = view.conference()
		var json = JSON.parse(retconferences)
		var i = 0
		while(true){
			$(#retconference).options.append("<option value='"+json.data[i].id+"'>"+json.data[i].conference_name+"</option>")
			i++
			if(i==json.total){
				break
			}
		}
        //ѡ���ļ�
        $(#selFile).on("click", function() {
            //�ļ�ɸѡ��
			 const filter = "Files (*.csv,*.xlsx)|*.CSV;*.XLSX|All Files (*.*)|*.*";
            ///const filter = "Files (*.csv,*.csv,*.jpeg,*.gif,*.csv)|*.csv,*.jpg;*.jpeg;*.gif;*.png|All Files (*.*)|*.*";
            //Ĭ�Ϻ�׺
            const defaultExt = ".csv";
            //��ʼ��·���������ļ�ѡ�񴰴�ʱ����·��
            const initialPath = System.path(#USER_DOCUMENTS);
            //����
            const caption = "ѡ��csv";
            file = view.selectFile(#open, filter, defaultExt, initialPath, caption );
            $(#filePath).text = file;
            return true;
        });
        //ѡ���ļ���
        $(#selFolder).on("click", function() {
            folder = view.selectFolder("ѡ������ļ���");
            $(#folderPath).text = folder;
        });
        //�ϴ��ļ�
        $(#uploadFile).on("click", function() {
			//��ȡselect��option����ѡȡselect��Ȼ����$$�Ҳ�������Ԫ��
			var opt = $(select[name='conference']).$$(option);
			var conferenceid = 0;
			for(var child in opt) {
				//�ж�Ԫ���Ƿ�ѡ��
				if(child.getState(Element.STATE_CHECKED)) {
					conferenceid = child.value;
				}
			}
			view.dump(conferenceid)
			if(conferenceid == 0) {
				view.msgbox(#warning, "��ѡ��Ҫ����Ļ���");
				return false;
			}
			
			$(#respRet).text = "";
			if(file.length == 0) {
				view.msgbox(#warning, "��ѡ���ļ�");
				return false;
			}
			if(folder.length == 0) {
				view.msgbox(#warning, "��ѡ��ͷ���ļ���");
				return false;
			}
			
			if(click_enable && file && folder��&& conferenceid) {
					click_enable = false
					var ret = view.upload(file, folder,conferenceid);
					click_enable = true
					file=""
					folder=""
					$(#respRet).text = ret;
			}else{
				    view.msgbox(#warning, "������ѡ��");
			}
        });
    };
</script>
</body>
</html>